---
title: "Explorative Analysis"
author: "MD"
date: "18 5 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if(!require("pacman"))install.packages("pacman")
pacman::p_load("tidyverse", "fs", "knitr", "pander")
read_chunk(path("R","clean.R"))
read_chunk(path("R","get_data.R"))
```

```{r spec, include=FALSE}
```

## Vorbereitung

Wir laden den Datensatz unter dem Namen "mach" ein und entfernen alle störenden Elemente.
Datensätze werden in R dataframes genannt. 

```{r read}
```

Danach legen wir eine neue Spalte namens "psy" in mach an, die anzeigt, ob das Studienfach (die Spalte major) die Zeichenfolge "psych" enthält, und eine Spalte "mach", die den Mittelwert relevant für mach angibt. 

```{r clean, include=FALSE}
```

## Arbeit mit den Daten

Mit welchen Persönlichkeitvariablen korreliert Machiavilismus am stärksten?

```{r}
select(mach, starts_with("TIPI")) %>%
  map(cor.test, mach$mach) %>% 
  map_dfr(broom::tidy, .id = "variable") %>% 
  arrange(desc(abs(statistic))) %>% 
  select(variable, estimate, statistic) %>% 
  pander()
```

```{r}
ggplot(mach, aes(TIPI7, mach)) +
  geom_jitter(alpha = .05) +
  theme_minimal()

ggplot(mach, aes(TIPI2, mach)) +
  geom_jitter(alpha = .05) +
  theme_minimal()

ggplot(mach, aes(TIPI1, mach)) +
  geom_jitter(alpha = .05) +
  theme_minimal()
```

Ist dieser Trend unterschiedlich für Frauen, Männer, andere und unbekannt?

```{r}
ggplot(mach, aes(TIPI7, mach)) +
  geom_jitter(alpha = .05) +
  facet_wrap(~gender) +
  geom_smooth(method = "lm") +
  theme_minimal()
```

Wie sind die unterschiedlichsten Verteilungen von den "mach"-Items für Geschlechter?

```{r}
select(mach, starts_with("Q")) %>%
  map(as.character) %>% 
  map(chisq.test, mach$gender) %>% 
  map_dfr(broom::tidy, .id = "variable") %>% 
  arrange(desc(statistic)) %>% 
  pander()
```

```{r}
mach %>% 
  group_by(gender, Q9I) %>% 
  summarise(n = n()) %>%
  mutate(prop = n / sum(n)) %>% 
  ggplot(aes(Q9I, prop, fill = gender)) +
  geom_col(position = "dodge") +
  theme_minimal()

mach %>% 
  filter(gender %in% c("m", "f")) %>% 
  group_by(gender, Q14I) %>% 
  summarise(n = n()) %>%
  mutate(prop = n / sum(n)) %>% 
  ggplot(aes(Q14I, prop, fill = gender)) +
  geom_col(position = "dodge") +
  theme_minimal()
```

```{r}
mach %>% group_by(gender) %>% summarise(n = n())
mach %>% group_by(gender, engnat) %>% summarise(n = n())
```
